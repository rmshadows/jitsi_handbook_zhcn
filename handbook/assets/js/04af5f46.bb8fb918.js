"use strict";(self.webpackChunk_jitsi_handbook=self.webpackChunk_jitsi_handbook||[]).push([[7497],{4530:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>r,contentTitle:()=>c,default:()=>j,frontMatter:()=>t,metadata:()=>d,toc:()=>l});var s=n(4848),o=n(8453);const t={id:"secure-domain",title:"Secure Domain setup - \u5b89\u5168\u57df\u914d\u7f6e",sidebar_label:"Authentication (Secure Domain) - \u8ba4\u8bc1\uff08\u5b89\u5168\u57df\uff09"},c=void 0,d={id:"devops-guide/secure-domain",title:"Secure Domain setup - \u5b89\u5168\u57df\u914d\u7f6e",description:"\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4ec5\u5141\u8bb8\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u521b\u5efa\u65b0\u7684\u4f1a\u8bae\u5ba4\u3002\u5f53\u4e00\u4e2a\u65b0\u7684\u623f\u95f4\u5373\u5c06\u88ab\u521b\u5efa\u65f6\uff0cJitsi Meet \u4f1a\u63d0\u793a\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u623f\u95f4\u521b\u5efa\u540e\uff0c\u5176\u4ed6\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u533f\u540d\u57df\u540d\u52a0\u5165\u4f1a\u8bae\u3002\u4ee5\u4e0b\u662f\u9700\u8981\u914d\u7f6e\u7684\u5185\u5bb9\uff1a",source:"@site/docs/devops-guide/secure-domain.md",sourceDirName:"devops-guide",slug:"/devops-guide/secure-domain",permalink:"/handbook/docs/devops-guide/secure-domain",draft:!1,unlisted:!1,editUrl:"https://github.com/jitsi/handbook/edit/master/docs/devops-guide/secure-domain.md",tags:[],version:"current",lastUpdatedAt:1729006689e3,frontMatter:{id:"secure-domain",title:"Secure Domain setup - \u5b89\u5168\u57df\u914d\u7f6e",sidebar_label:"Authentication (Secure Domain) - \u8ba4\u8bc1\uff08\u5b89\u5168\u57df\uff09"},sidebar:"docs",previous:{title:"Configuration",permalink:"/handbook/docs/category/configuration"},next:{title:"LDAP \u8ba4\u8bc1",permalink:"/handbook/docs/devops-guide/ldap-authentication"}},r={},l=[{value:"Prosody \u914d\u7f6e",id:"prosody-\u914d\u7f6e",level:2},{value:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1",id:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1",level:3},{value:"\u542f\u7528\u8bbf\u5ba2\u7684\u533f\u540d\u767b\u5f55",id:"\u542f\u7528\u8bbf\u5ba2\u7684\u533f\u540d\u767b\u5f55",level:3},{value:"Jitsi Meet \u914d\u7f6e",id:"jitsi-meet-\u914d\u7f6e",level:2},{value:"Jicofo \u914d\u7f6e",id:"jicofo-\u914d\u7f6e",level:2},{value:"\u5728 Prosody \u4e2d\u521b\u5efa\u7528\u6237\uff08\u5185\u90e8\u8ba4\u8bc1\uff09",id:"\u5728-prosody-\u4e2d\u521b\u5efa\u7528\u6237\u5185\u90e8\u8ba4\u8bc1",level:2},{value:"\u53ef\u9009\uff1aJigasi \u914d\u7f6e",id:"\u53ef\u9009jigasi-\u914d\u7f6e",level:2},{value:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1",id:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1-1",level:3},{value:"\u8c03\u8bd5",id:"\u8c03\u8bd5",level:3}];function a(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.p,{children:"\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4ec5\u5141\u8bb8\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u7528\u6237\u521b\u5efa\u65b0\u7684\u4f1a\u8bae\u5ba4\u3002\u5f53\u4e00\u4e2a\u65b0\u7684\u623f\u95f4\u5373\u5c06\u88ab\u521b\u5efa\u65f6\uff0cJitsi Meet \u4f1a\u63d0\u793a\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002\u623f\u95f4\u521b\u5efa\u540e\uff0c\u5176\u4ed6\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u533f\u540d\u57df\u540d\u52a0\u5165\u4f1a\u8bae\u3002\u4ee5\u4e0b\u662f\u9700\u8981\u914d\u7f6e\u7684\u5185\u5bb9\uff1a"}),"\n",(0,s.jsx)(i.h2,{id:"prosody-\u914d\u7f6e",children:"Prosody \u914d\u7f6e"}),"\n",(0,s.jsxs)(i.p,{children:["\u5982\u679c\u4f60\u662f\u901a\u8fc7 Debian \u5305\u5b89\u88c5\u7684 Jitsi Meet\uff0c\u4ee5\u4e0b\u66f4\u6539\u5e94\u5728 ",(0,s.jsx)(i.code,{children:"/etc/prosody/conf.avail/[your-hostname].cfg.lua"})," \u6587\u4ef6\u4e2d\u8fdb\u884c\u3002"]}),"\n",(0,s.jsx)(i.h3,{id:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1",children:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1"}),"\n",(0,s.jsxs)(i.p,{children:["\u5728 ",(0,s.jsx)(i.code,{children:'VirtualHost "[your-hostname]"'})," \u5757\u4e2d\uff0c\u5c06\u533f\u540d\u8eab\u4efd\u9a8c\u8bc1\u66ff\u6362\u4e3a\u54c8\u5e0c\u5bc6\u7801\u8eab\u4efd\u9a8c\u8bc1\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'VirtualHost "jitsi-meet.example.com"\n    authentication = "internal_hashed"\n'})}),"\n",(0,s.jsxs)(i.p,{children:["\u5c06 ",(0,s.jsx)(i.code,{children:"jitsi-meet.example.com"})," \u66ff\u6362\u4e3a\u4f60\u7684\u4e3b\u673a\u540d\u3002"]}),"\n",(0,s.jsx)(i.h3,{id:"\u542f\u7528\u8bbf\u5ba2\u7684\u533f\u540d\u767b\u5f55",children:"\u542f\u7528\u8bbf\u5ba2\u7684\u533f\u540d\u767b\u5f55"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.strong,{children:"\u5728\u524d\u4e00\u4e2a VirtualHost \u4e4b\u540e"})," \u6dfb\u52a0\u4ee5\u4e0b\u5757\u4ee5\u542f\u7528\u8bbf\u5ba2\u7684\u533f\u540d\u767b\u5f55\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:'VirtualHost "guest.jitsi-meet.example.com"\n    authentication = "anonymous"\n    c2s_require_encryption = false\n'})}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsxs)(i.em,{children:["\u6ce8\u610f\uff1a",(0,s.jsx)(i.code,{children:"guest.jitsi-meet.example.com"})," \u4ec5\u7528\u4e8e Jitsi \u5185\u90e8\uff0c\u4e0d\u9700\u8981\uff08\u4e5f\u4e0d\u5e94\u8be5\uff09\u4e3a\u5b83\u521b\u5efa DNS \u8bb0\u5f55\u3001\u751f\u6210 SSL/TLS \u8bc1\u4e66\u6216\u8fdb\u884c\u4efb\u4f55 web \u670d\u52a1\u5668\u914d\u7f6e\u3002\u867d\u7136\u5b83\u662f\u5185\u90e8\u4f7f\u7528\u7684\uff0c\u4f46\u4ecd\u5e94\u5c06 ",(0,s.jsx)(i.code,{children:"jitsi-meet.example.com"})," \u66ff\u6362\u4e3a\u4f60\u7684\u4e3b\u673a\u540d\u3002"]})}),"\n",(0,s.jsx)(i.h2,{id:"jitsi-meet-\u914d\u7f6e",children:"Jitsi Meet \u914d\u7f6e"}),"\n",(0,s.jsxs)(i.p,{children:["\u5728 ",(0,s.jsx)(i.code,{children:"config.js"})," \u6587\u4ef6\u4e2d\uff0c\u9700\u8981\u8bbe\u7f6e ",(0,s.jsx)(i.code,{children:"anonymousdomain"})," \u9009\u9879\u3002"]}),"\n",(0,s.jsxs)(i.p,{children:["\u5982\u679c\u4f60\u662f\u901a\u8fc7 Debian \u5305\u5b89\u88c5\u7684 jitsi-meet\uff0c\u4ee5\u4e0b\u66f4\u6539\u5e94\u5728 ",(0,s.jsx)(i.code,{children:"/etc/jitsi/meet/[your-hostname]-config.js"})," \u6587\u4ef6\u4e2d\u8fdb\u884c\u3002"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"var config = {\n    hosts: {\n            domain: 'jitsi-meet.example.com',\n            anonymousdomain: 'guest.jitsi-meet.example.com',\n            ...\n        },\n        ...\n}\n"})}),"\n",(0,s.jsx)(i.h2,{id:"jicofo-\u914d\u7f6e",children:"Jicofo \u914d\u7f6e"}),"\n",(0,s.jsxs)(i.p,{children:["\u8fd0\u884c Jicofo \u65f6\uff0c\u9700\u5728\u9644\u52a0\u7684\u914d\u7f6e\u5c5e\u6027\u4e2d\u6307\u5b9a\u4f60\u7684\u4e3b\u57df\u540d\u3002Jicofo \u53ea\u4f1a\u63a5\u53d7\u6765\u81ea\u7ecf\u8fc7\u8eab\u4efd\u9a8c\u8bc1\u7684\u57df\u7684\u4f1a\u8bae\u5206\u914d\u8bf7\u6c42\u3002\u5e94\u5728 ",(0,s.jsx)(i.code,{children:"/etc/jitsi/jicofo/jicofo.conf"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u65b0\u7684 ",(0,s.jsx)(i.code,{children:"authentication"})," \u90e8\u5206\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"jicofo {\n  authentication: {\n    enabled: true\n    type: XMPP\n    login-url: jitsi-meet.example.com\n }\n ...\n"})}),"\n",(0,s.jsxs)(i.p,{children:["\u5982\u679c\u4f7f\u7528\u57fa\u4e8e\u4ee4\u724c\u7684\u8eab\u4efd\u9a8c\u8bc1\uff0c\u7c7b\u578b\u5e94\u6539\u4e3a ",(0,s.jsx)(i.code,{children:"JWT"}),"\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"jicofo {\n  authentication: {\n    enabled: true\n    type: JWT\n    login-url: jitsi-meet.example.com\n }\n ...\n"})}),"\n",(0,s.jsx)(i.h2,{id:"\u5728-prosody-\u4e2d\u521b\u5efa\u7528\u6237\u5185\u90e8\u8ba4\u8bc1",children:"\u5728 Prosody \u4e2d\u521b\u5efa\u7528\u6237\uff08\u5185\u90e8\u8ba4\u8bc1\uff09"}),"\n",(0,s.jsxs)(i.p,{children:["\u6700\u540e\uff0c\u8fd0\u884c ",(0,s.jsx)(i.code,{children:"prosodyctl"})," \u6765\u5728 Prosody \u4e2d\u521b\u5efa\u7528\u6237\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"sudo prosodyctl register <username> jitsi-meet.example.com <password>\n"})}),"\n",(0,s.jsx)(i.p,{children:"\u7136\u540e\u91cd\u542f Prosody\u3001Jicofo \u548c jitsi-videobridge2\uff1a"}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"systemctl restart prosody\nsystemctl restart jicofo\nsystemctl restart jitsi-videobridge2\n"})}),"\n",(0,s.jsxs)(i.admonition,{type:"note",children:[(0,s.jsxs)(i.p,{children:["Docker \u7528\u6237\u53ef\u80fd\u9700\u8981\u4f7f\u7528\u66ff\u4ee3\u7684\u914d\u7f6e\u8def\u5f84\u3002\u4f7f\u7528\u5b98\u65b9 ",(0,s.jsx)(i.a,{href:"https://github.com/jitsi/docker-jitsi-meet",children:(0,s.jsx)(i.code,{children:"jitsi/prosody"})})," \u955c\u50cf\u7684\u7528\u6237\u5e94\u6309\u5982\u4e0b\u65b9\u5f0f\u8c03\u7528 ",(0,s.jsx)(i.code,{children:"prosodyctl"}),"\u3002"]}),(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"prosodyctl --config /config/prosody.cfg.lua register <username> meet.jitsi <password>\n"})}),(0,s.jsxs)(i.p,{children:["\u5173\u4e8e ",(0,s.jsx)(i.code,{children:"prosodyctl"})," \u7684\u5b8c\u6574\u6587\u6863\u53ef\u4ee5\u53c2\u8003",(0,s.jsx)(i.a,{href:"https://prosody.im/doc/prosodyctl",children:"\u5b98\u7f51"}),"\u3002"]})]}),"\n",(0,s.jsx)(i.h2,{id:"\u53ef\u9009jigasi-\u914d\u7f6e",children:"\u53ef\u9009\uff1aJigasi \u914d\u7f6e"}),"\n",(0,s.jsx)(i.h3,{id:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1-1",children:"\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1"}),"\n",(0,s.jsxs)(i.p,{children:["\u5982\u679c\u4f7f\u7528 Jigasi\uff0c\u53ef\u4ee5\u901a\u8fc7\u7f16\u8f91 ",(0,s.jsx)(i.code,{children:"/etc/jitsi/jigasi/sip-communicator.properties"})," \u6587\u4ef6\u4e2d\u7684\u4ee5\u4e0b\u884c\u6765\u542f\u7528\u8eab\u4efd\u9a8c\u8bc1\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"org.jitsi.jigasi.xmpp.acc.USER_ID=SOME_USER@SOME_DOMAIN\norg.jitsi.jigasi.xmpp.acc.PASS=SOME_PASS\norg.jitsi.jigasi.xmpp.acc.ANONYMOUS_AUTH=false\n"})}),"\n",(0,s.jsx)(i.p,{children:"\u6ce8\u610f\uff1a\u5bc6\u7801\u4e3a\u660e\u6587\u5bc6\u7801\uff0c\u800c\u975e base64 \u7f16\u7801\u3002"}),"\n",(0,s.jsx)(i.h3,{id:"\u8c03\u8bd5",children:"\u8c03\u8bd5"}),"\n",(0,s.jsxs)(i.p,{children:["\u5982\u679c\u9047\u5230\u8bc1\u4e66\u94fe\u95ee\u9898\uff0c\u53ef\u80fd\u9700\u8981\u53d6\u6d88\u6ce8\u91ca ",(0,s.jsx)(i.code,{children:"sip-communicator.properties"})," \u6587\u4ef6\u4e2d\u7684\u4ee5\u4e0b\u884c\uff1a"]}),"\n",(0,s.jsx)(i.pre,{children:(0,s.jsx)(i.code,{children:"net.java.sip.communicator.service.gui.ALWAYS_TRUST_MODE_ENABLED=true\n"})}),"\n",(0,s.jsx)(i.admonition,{type:"note",children:(0,s.jsx)(i.p,{children:"\u6b64\u8bbe\u7f6e\u4ec5\u5e94\u7528\u4e8e\u6d4b\u8bd5/\u8c03\u8bd5\u6216\u53d7\u63a7\u73af\u5883\u4e2d\u3002\u5982\u679c\u786e\u8ba4\u8fd9\u662f\u95ee\u9898\u6240\u5728\uff0c\u5e94\u8be5\u901a\u8fc7\u5176\u4ed6\u65b9\u5f0f\u89e3\u51b3\uff08\u4f8b\u5982\u4e3a Prosody \u83b7\u53d6\u7b7e\u540d\u8bc1\u4e66\uff0c\u6216\u5c06\u7279\u5b9a\u8bc1\u4e66\u6dfb\u52a0\u5230 Jigasi \u7684\u4fe1\u4efb\u5e93\u4e2d\uff09\u3002"})})]})}function j(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>c,x:()=>d});var s=n(6540);const o={},t=s.createContext(o);function c(e){const i=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(t.Provider,{value:i},e.children)}}}]);