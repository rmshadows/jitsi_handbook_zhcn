"use strict";(self.webpackChunk_jitsi_handbook=self.webpackChunk_jitsi_handbook||[]).push([[1401],{5292:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>l,toc:()=>d});var r=s(4848),o=s(8453);const i={id:"reservation",title:"Reservation System setup - \u914d\u7f6e\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",sidebar_label:"Reservation System - \u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf"},t=void 0,l={id:"devops-guide/reservation",title:"Reservation System setup - \u914d\u7f6e\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",description:"Support for a reservation system over REST API",source:"@site/docs/devops-guide/reservation.md",sourceDirName:"devops-guide",slug:"/devops-guide/reservation",permalink:"/handbook/docs/devops-guide/reservation",draft:!1,unlisted:!1,editUrl:"https://github.com/jitsi/handbook/edit/master/docs/devops-guide/reservation.md",tags:[],version:"current",lastUpdatedAt:1729006689e3,frontMatter:{id:"reservation",title:"Reservation System setup - \u914d\u7f6e\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",sidebar_label:"Reservation System - \u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf"},sidebar:"docs",previous:{title:"Scalable setup - \u53ef\u6269\u5c55\u6027\u914d\u7f6e",permalink:"/handbook/docs/devops-guide/devops-guide-scalable"},next:{title:"TURN setup - \u8bbe\u7f6e TURN \u670d\u52a1\u5668",permalink:"/handbook/docs/devops-guide/turn"}},c={},d=[{value:"Support for a reservation system over REST API",id:"support-for-a-reservation-system-over-rest-api",level:3},{value:"Enable reservation system",id:"enable-reservation-system",level:4},{value:"Call flow",id:"call-flow",level:4},{value:"Notes",id:"notes",level:5},{value:"Conference allocation",id:"conference-allocation",level:5},{value:"HTTP 200 or 201 Conference created successfully",id:"http-200-or-201-conference-created-successfully",level:6},{value:"\u901a\u8fc7REST API\u652f\u6301\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",id:"\u901a\u8fc7rest-api\u652f\u6301\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",level:3},{value:"\u542f\u7528\u9884\u8ba2\u7cfb\u7edf",id:"\u542f\u7528\u9884\u8ba2\u7cfb\u7edf",level:4},{value:"\u8c03\u7528\u6d41\u7a0b",id:"\u8c03\u7528\u6d41\u7a0b",level:4},{value:"\u6ce8\u610f",id:"\u6ce8\u610f",level:5},{value:"\u4f1a\u8bae\u5206\u914d",id:"\u4f1a\u8bae\u5206\u914d",level:5},{value:"HTTP 200 \u6216 201 \u4f1a\u8bae\u521b\u5efa\u6210\u529f",id:"http-200-\u6216-201-\u4f1a\u8bae\u521b\u5efa\u6210\u529f",level:6},{value:"HTTP 409 - \u4f1a\u8bae\u5df2\u5b58\u5728",id:"http-409---\u4f1a\u8bae\u5df2\u5b58\u5728",level:6},{value:"HTTP 4xx",id:"http-4xx",level:6},{value:"\u8bfb\u53d6\u4f1a\u8bae\u4fe1\u606f",id:"\u8bfb\u53d6\u4f1a\u8bae\u4fe1\u606f",level:5},{value:"\u5220\u9664\u4f1a\u8bae",id:"\u5220\u9664\u4f1a\u8bae",level:5},{value:"\u5b9e\u65bd\u56fe",id:"\u5b9e\u65bd\u56fe",level:4}];function a(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",h5:"h5",h6:"h6",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h3,{id:"support-for-a-reservation-system-over-rest-api",children:"Support for a reservation system over REST API"}),"\n",(0,r.jsx)(n.p,{children:"It is possible to connect to an external conference reservation system using a\nREST API. Before a new Jitsi Meet conference is created, the reservation system will be\nqueried for room availability. The system is supposed to return a positive or\nnegative response code, which also contains conference duration. Prosody will enforce\nconference duration and if the time limit is exceeded the conference will be\nterminated."}),"\n",(0,r.jsx)(n.h4,{id:"enable-reservation-system",children:"Enable reservation system"}),"\n",(0,r.jsxs)(n.p,{children:['In order to enable the reservation system, the URL base for the REST API endpoint must be\nconfigured. Under the main virtual host in prosody, enable module "reservations" and\nadd the config ',(0,r.jsx)(n.code,{children:"reservations_api_prefix"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'VirtualHost "jitmeet.example.com"\n    -- ....\n    modules_enabled = {\n        -- ....\n        "reservations";\n    }\n    reservations_api_prefix = "http://reservation.example.com"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The URL base is used to construct the request URL. Currently, only ",(0,r.jsx)(n.code,{children:"'/conference'"}),"\nendpoint is supported, so all request will go to:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"http://reservation.example.com/conference\n"})}),"\n",(0,r.jsx)(n.p,{children:"Additional configuration options are available:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"reservations_api_timeout" to change API call timeouts (defaults to 20 seconds)'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_headers" to specify custom HTTP headers included in\nall API calls e.g. to provide auth tokens.'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_retry_count" to specify the number of times API call failures are retried (defaults to 3)'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_retry_delay" seconds to wait between retries (defaults to 3s)'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_should_retry_for_code" as a function that takes an HTTP response code and\nreturns true if the API call should be retried. By default, retries are done for 5XX\nresponses. Timeouts are never retried, and HTTP call failures are always retried.'}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_max_occupants" to enable support for setting max occupants. If this is set to ',(0,r.jsx)(n.code,{children:"true"}),', and if\nthe API response payload includes a "max_occupants" value, then that value will be set as the max occupancy limit\nfor that specific room.',"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"muc_max_occupants" module must also be enabled for this to work.'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_lobby_support" to enable support for lobby. If this is set to ',(0,r.jsx)(n.code,{children:"true"}),', and if\nthe API response payload includes a "lobby" field set to ',(0,r.jsx)(n.code,{children:"true"})," , then the lobby will be enabled for the room.","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"muc_lobby_rooms" and "persistent_lobby" modules must also be enabled for this to work.'}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_password_support" to enable support for room password. If this is set to ',(0,r.jsx)(n.code,{children:"true"}),', and if\nthe API response payload includes a "password" value, then that value will be set as room password. Users will then\nbe required to know that password to be able to join the room, or in the case where lobby is enabled, can use the\npassword to bypass the lobby.']}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'    --- The following are all optional\n    reservations_api_headers = {\n        ["Authorization"] = "Bearer TOKEN-237958623045";\n    }\n    reservations_api_timeout = 10  -- timeout if API does not respond within 10s\n    reservations_api_retry_count = 5  -- retry up to 5 times\n    reservations_api_retry_delay = 1  -- wait 1s between retries\n    reservations_api_should_retry_for_code = function (code)\n        return code >= 500 or code == 408\n    end\n    reservations_enable_max_occupants = true -- enable integration with muc_max_occupants\n    reservations_enable_lobby_support = true -- enable integration with muc_lobby_rooms\n    reservations_enable_password_support = true -- enable support for setting room passwords\n'})}),"\n",(0,r.jsx)(n.h4,{id:"call-flow",children:"Call flow"}),"\n",(0,r.jsx)(n.h5,{id:"notes",children:"Notes"}),"\n",(0,r.jsx)(n.p,{children:"All API calls use the following datetime format:"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"yyyy-MM-dd'T'HH:mm:ss.SSSX"})," - more info can be found in\n",(0,r.jsx)(n.code,{children:"SimpleDateFormat"})," ",(0,r.jsx)(n.a,{href:"https://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html",children:"JavaDoc"})]}),"\n",(0,r.jsx)(n.h5,{id:"conference-allocation",children:"Conference allocation"}),"\n",(0,r.jsxs)(n.p,{children:["When the first user joins a MUC room (i.e. Jitsi Meet URL is opened), an ",(0,r.jsx)(n.code,{children:"HTTP POST"}),"\nrequest is sent to ",(0,r.jsx)(n.code,{children:"'/conference'"})," endpoint with the following parameters\nincluded:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"name (string)"})," - short name of the conference room (not full MUC address). If tenant is used, the name will be ",(0,r.jsx)(n.code,{children:"[tenant]roomname"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"start_time (string)"})," - conference start date and time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mail_owner (string)"})," - if authentication system is enabled this field will\ncontain user's identity. It that case it will not be possible to create a new\nconference room without authenticating."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The payload sent to the endpoint will be encoded as ",(0,r.jsx)(n.code,{children:"application/x-www-form-urlencoded"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"The reservation system is expected to respond with one of the following\nresponses:"}),"\n",(0,r.jsx)(n.h6,{id:"http-200-or-201-conference-created-successfully",children:"HTTP 200 or 201 Conference created successfully"}),"\n",(0,r.jsxs)(n.p,{children:["In the HTTP response, a JSON object is expected. It should contain conference ",(0,r.jsx)(n.code,{children:"id"}),"\nassigned by the system and ",(0,r.jsx)(n.code,{children:"duration"})," measured in seconds. Sample response body:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "id": 364758328,\n  "name": "conference1234",\n  "mail_owner": "user@server.com",\n  "start_time": "2048-04-20T17:55:12.000Z",\n  "duration": 900000\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["The object can optionally include a ",(0,r.jsx)(n.code,{children:"max_occupants"})," key with an integer value. When provided, and if\n",(0,r.jsx)(n.code,{children:"reservations_enable_max_occupants"})," is enabled, then the value will be passed to muc_mod_max_occupants to enforce\nper-room occupancy limits."]}),"\n",(0,r.jsx)(n.h3,{id:"\u901a\u8fc7rest-api\u652f\u6301\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf",children:"\u901a\u8fc7REST API\u652f\u6301\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf"}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u901a\u8fc7REST API\u8fde\u63a5\u5230\u5916\u90e8\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf\u3002\u5728\u521b\u5efa\u65b0\u7684Jitsi Meet\u4f1a\u8bae\u4e4b\u524d\uff0c\u7cfb\u7edf\u5c06\u67e5\u8be2\u9884\u8ba2\u7cfb\u7edf\u4ee5\u83b7\u53d6\u623f\u95f4\u53ef\u7528\u6027\u3002\u7cfb\u7edf\u5e94\u8fd4\u56de\u4e00\u4e2a\u6b63\u6216\u8d1f\u7684\u54cd\u5e94\u4ee3\u7801\uff0c\u540c\u65f6\u5305\u542b\u4f1a\u8bae\u6301\u7eed\u65f6\u95f4\u3002Prosody\u5c06\u5f3a\u5236\u6267\u884c\u4f1a\u8bae\u6301\u7eed\u65f6\u95f4\uff0c\u5982\u679c\u8d85\u51fa\u65f6\u95f4\u9650\u5236\uff0c\u4f1a\u8bae\u5c06\u88ab\u7ec8\u6b62\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u542f\u7528\u9884\u8ba2\u7cfb\u7edf",children:"\u542f\u7528\u9884\u8ba2\u7cfb\u7edf"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3a\u4e86\u542f\u7528\u9884\u8ba2\u7cfb\u7edf\uff0c\u5fc5\u987b\u914d\u7f6eREST API\u7aef\u70b9\u7684\u57fa\u672cURL\u3002\u5728Prosody\u7684\u4e3b\u865a\u62df\u4e3b\u673a\u4e0b\uff0c\u542f\u7528\u201creservations\u201d\u6a21\u5757\u5e76\u6dfb\u52a0\u914d\u7f6e ",(0,r.jsx)(n.code,{children:"reservations_api_prefix"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'VirtualHost "jitmeet.example.com"\n    -- ....\n    modules_enabled = {\n        -- ....\n        "reservations";\n    }\n    reservations_api_prefix = "http://reservation.example.com"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5URL\u57fa\u672c\u7528\u4e8e\u6784\u5efa\u8bf7\u6c42URL\u3002\u76ee\u524d\uff0c\u4ec5\u652f\u6301",(0,r.jsx)(n.code,{children:"'/conference'"}),"\u7aef\u70b9\uff0c\u56e0\u6b64\u6240\u6709\u8bf7\u6c42\u5c06\u53d1\u9001\u5230\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"http://reservation.example.com/conference\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u7528\u7684\u5176\u4ed6\u914d\u7f6e\u9009\u9879\u5305\u62ec\uff1a"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'"reservations_api_timeout"\uff1a\u66f4\u6539API\u8c03\u7528\u8d85\u65f6\uff08\u9ed8\u8ba4\u4e3a20\u79d2\uff09'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_headers"\uff1a\u6307\u5b9a\u6240\u6709API\u8c03\u7528\u4e2d\u5305\u542b\u7684\u81ea\u5b9a\u4e49HTTP\u5934\uff0c\u4f8b\u5982\u63d0\u4f9b\u8eab\u4efd\u9a8c\u8bc1\u4ee4\u724c\u3002'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_retry_count"\uff1a\u6307\u5b9aAPI\u8c03\u7528\u5931\u8d25\u65f6\u7684\u91cd\u8bd5\u6b21\u6570\uff08\u9ed8\u8ba4\u4e3a3\uff09'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_retry_delay"\uff1a\u91cd\u8bd5\u4e4b\u95f4\u7b49\u5f85\u7684\u79d2\u6570\uff08\u9ed8\u8ba4\u4e3a3\u79d2\uff09'}),"\n",(0,r.jsx)(n.li,{children:'"reservations_api_should_retry_for_code"\uff1a\u4e00\u4e2a\u51fd\u6570\uff0c\u63a5\u53d7HTTP\u54cd\u5e94\u4ee3\u7801\u5e76\u8fd4\u56detrue\uff0c\u5982\u679cAPI\u8c03\u7528\u5e94\u91cd\u8bd5\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5bf95XX\u54cd\u5e94\u8fdb\u884c\u91cd\u8bd5\u3002\u8d85\u65f6\u4e0d\u4f1a\u91cd\u8bd5\uff0cHTTP\u8c03\u7528\u5931\u8d25\u5c06\u59cb\u7ec8\u91cd\u8bd5\u3002'}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_max_occupants"\uff1a\u542f\u7528\u8bbe\u7f6e\u6700\u5927\u5360\u7528\u4eba\u6570\u7684\u652f\u6301\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a',(0,r.jsx)(n.code,{children:"true"}),"\uff0c\u5e76\u4e14API\u54cd\u5e94\u6709\u6548\u8d1f\u8f7d\u4e2d\u5305\u542b\u201cmax_occupants\u201d\u503c\uff0c\u5219\u8be5\u503c\u5c06\u88ab\u8bbe\u7f6e\u4e3a\u8be5\u7279\u5b9a\u623f\u95f4\u7684\u6700\u5927\u5360\u7528\u9650\u5236\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5fc5\u987b\u542f\u7528\u201cmuc_max_occupants\u201d\u6a21\u5757\u4ee5\u4f7f\u5176\u5de5\u4f5c\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_lobby_support"\uff1a\u542f\u7528\u5927\u5385\u7684\u652f\u6301\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a',(0,r.jsx)(n.code,{children:"true"}),"\uff0c\u5e76\u4e14API\u54cd\u5e94\u6709\u6548\u8d1f\u8f7d\u4e2d\u5305\u542b\u4e00\u4e2a\u201clobby\u201d\u5b57\u6bb5\uff0c\u8bbe\u7f6e\u4e3a",(0,r.jsx)(n.code,{children:"true"}),"\uff0c\u5219\u5c06\u4e3a\u623f\u95f4\u542f\u7528\u5927\u5385\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5fc5\u987b\u542f\u7528\u201cmuc_lobby_rooms\u201d\u548c\u201cpersistent_lobby\u201d\u6a21\u5757\u4ee5\u4f7f\u5176\u5de5\u4f5c\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:['"reservations_enable_password_support"\uff1a\u542f\u7528\u623f\u95f4\u5bc6\u7801\u7684\u652f\u6301\u3002\u5982\u679c\u8bbe\u7f6e\u4e3a',(0,r.jsx)(n.code,{children:"true"}),"\uff0c\u5e76\u4e14API\u54cd\u5e94\u6709\u6548\u8d1f\u8f7d\u4e2d\u5305\u542b\u4e00\u4e2a\u201cpassword\u201d\u503c\uff0c\u5219\u8be5\u503c\u5c06\u88ab\u8bbe\u7f6e\u4e3a\u623f\u95f4\u5bc6\u7801\u3002\u7528\u6237\u5c06\u9700\u8981\u77e5\u9053\u8be5\u5bc6\u7801\u624d\u80fd\u52a0\u5165\u623f\u95f4\uff0c\u6216\u8005\u5728\u542f\u7528\u5927\u5385\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u4f7f\u7528\u8be5\u5bc6\u7801\u7ed5\u8fc7\u5927\u5385\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'    --- The following are all optional \u4ee5\u4e0b\u90fd\u662f\u53ef\u9009\u9879\n    reservations_api_headers = {\n        ["Authorization"] = "Bearer TOKEN-237958623045";\n    }\n    reservations_api_timeout = 10  -- timeout if API does not respond within 10s \u5982\u679cAPI\u572810\u79d2\u5185\u6ca1\u6709\u54cd\u5e94\u5219\u8d85\u65f6\n    reservations_api_retry_count = 5  -- retry up to 5 times \u6700\u591a\u91cd\u8bd55\u6b21\n    reservations_api_retry_delay = 1  -- wait 1s between retries \u91cd\u8bd5\u4e4b\u95f4\u7b49\u5f851\u79d2\n    reservations_api_should_retry_for_code = function (code)\n        return code >= 500 or code == 408\n    end\n    reservations_enable_max_occupants = true -- enable integration with muc_max_occupants \u542f\u7528\u4e0emuc_max_occupants\u7684\u96c6\u6210\n    reservations_enable_lobby_support = true -- enable integration with muc_lobby_rooms \u542f\u7528\u4e0emuc_lobby_rooms\u7684\u96c6\u6210\n    reservations_enable_password_support = true -- enable support for setting room passwords \u542f\u7528\u8bbe\u7f6e\u623f\u95f4\u5bc6\u7801\u7684\u652f\u6301\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u8c03\u7528\u6d41\u7a0b",children:"\u8c03\u7528\u6d41\u7a0b"}),"\n",(0,r.jsx)(n.h5,{id:"\u6ce8\u610f",children:"\u6ce8\u610f"}),"\n",(0,r.jsx)(n.p,{children:"\u6240\u6709API\u8c03\u7528\u4f7f\u7528\u4ee5\u4e0b\u65e5\u671f\u65f6\u95f4\u683c\u5f0f\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"yyyy-MM-dd'T'HH:mm:ss.SSSX"})," - \u66f4\u591a\u4fe1\u606f\u53ef\u4ee5\u5728",(0,r.jsx)(n.code,{children:"SimpleDateFormat"})," ",(0,r.jsx)(n.a,{href:"https://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html",children:"JavaDoc"}),"\u4e2d\u627e\u5230\u3002"]}),"\n",(0,r.jsx)(n.h5,{id:"\u4f1a\u8bae\u5206\u914d",children:"\u4f1a\u8bae\u5206\u914d"}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u7b2c\u4e00\u4e2a\u7528\u6237\u52a0\u5165MUC\u623f\u95f4\uff08\u5373\u6253\u5f00Jitsi Meet URL\uff09\u65f6\uff0c\u5c06\u5411",(0,r.jsx)(n.code,{children:"'/conference'"}),"\u7aef\u70b9\u53d1\u9001\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"HTTP POST"}),"\u8bf7\u6c42\uff0c\u5e76\u5305\u542b\u4ee5\u4e0b\u53c2\u6570\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"name (string)"})," - \u4f1a\u8bae\u5ba4\u7684\u7b80\u77ed\u540d\u79f0\uff08\u4e0d\u662f\u5b8c\u6574\u7684MUC\u5730\u5740\uff09\u3002\u5982\u679c\u4f7f\u7528\u79df\u6237\uff0c\u540d\u79f0\u5c06\u4e3a",(0,r.jsx)(n.code,{children:"[tenant]roomname"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"start_time (string)"})," - \u4f1a\u8bae\u5f00\u59cb\u7684\u65e5\u671f\u548c\u65f6\u95f4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mail_owner (string)"})," - \u5982\u679c\u542f\u7528\u4e86\u8eab\u4efd\u9a8c\u8bc1\u7cfb\u7edf\uff0c\u8be5\u5b57\u6bb5\u5c06\u5305\u542b\u7528\u6237\u7684\u8eab\u4efd\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u65e0\u6cd5\u5728\u672a\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1\u7684\u60c5\u51b5\u4e0b\u521b\u5efa\u65b0\u7684\u4f1a\u8bae\u5ba4\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u53d1\u9001\u5230\u7aef\u70b9\u7684\u6709\u6548\u8d1f\u8f7d\u5c06\u4ee5",(0,r.jsx)(n.code,{children:"application/x-www-form-urlencoded"}),"\u7f16\u7801\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u9884\u8ba2\u7cfb\u7edf\u5e94\u4ee5\u4ee5\u4e0b\u54cd\u5e94\u4e4b\u4e00\u8fdb\u884c\u54cd\u5e94\uff1a"}),"\n",(0,r.jsx)(n.h6,{id:"http-200-\u6216-201-\u4f1a\u8bae\u521b\u5efa\u6210\u529f",children:"HTTP 200 \u6216 201 \u4f1a\u8bae\u521b\u5efa\u6210\u529f"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728HTTP\u54cd\u5e94\u4e2d\uff0c\u671f\u671b\u4e00\u4e2aJSON\u5bf9\u8c61\u3002\u5b83\u5e94\u5305\u542b\u7cfb\u7edf\u5206\u914d\u7684\u4f1a\u8bae",(0,r.jsx)(n.code,{children:"id"}),"\u548c\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684",(0,r.jsx)(n.code,{children:"duration"}),"\u3002\u793a\u4f8b\u54cd\u5e94\u4e3b\u4f53\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "id": 364758328,\n  "name": "conference1234",\n  "mail_owner": "user@server.com",\n  "start_time": "2048-04-20T17:55:12.000Z",\n  "duration": 900000\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5\u5bf9\u8c61\u53ef\u4ee5\u9009\u62e9\u6027\u5730\u5305\u542b\u4e00\u4e2a",(0,r.jsx)(n.code,{children:"max_occupants"}),"\u952e\uff0c\u5176\u503c\u4e3a\u6574\u6570\u3002\u5f53\u63d0\u4f9b\u65f6\uff0c\u5982\u679c\u542f\u7528\u4e86",(0,r.jsx)(n.code,{children:"reservations_enable_max_occupants"}),"\uff0c\u5219\u8be5\u503c\u5c06\u4f20\u9012\u7ed9muc_mod_max_occupants\u4ee5\u5f3a\u5236\u6267\u884c\u6bcf\u4e2a\u623f\u95f4\u7684\u5360\u7528\u9650\u5236\u3002"]}),"\n",(0,r.jsx)(n.h6,{id:"http-409---\u4f1a\u8bae\u5df2\u5b58\u5728",children:"HTTP 409 - \u4f1a\u8bae\u5df2\u5b58\u5728"}),"\n",(0,r.jsxs)(n.p,{children:["\u8fd9\u662f\u4e3a\u4e86\u4ece\u4e4b\u524d\u7684\u5931\u8d25\u4e2d\u6062\u590d\u3002\u5982\u679c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u4f1a\u8bae\u88ab\u91cd\u542f\uff0c\u800c\u7528\u6237\u5c1d\u8bd5\u518d\u6b21\u521b\u5efa\u623f\u95f4\uff0c\u5219\u8be5\u54cd\u5e94\u901a\u77e5Prosody\u4f1a\u8bae\u5ba4\u5df2\u7ecf\u5b58\u5728\u3002\u9884\u8ba1JSON\u54cd\u5e94\u4e3b\u4f53\u4e2d\u4f1a\u5305\u542b ",(0,r.jsx)(n.code,{children:"conflict_id"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "conflict_id": 364758328\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Prosody\u5c06\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"HTTP GET"})," \u8bf7\u6c42\u83b7\u53d6\u6709\u5173\u7ed9\u5b9a ",(0,r.jsx)(n.code,{children:"conflict_id"})," \u7684\u51b2\u7a81\u4f1a\u8bae\u7684\u4fe1\u606f\u3002\u6709\u5173\u6b64\u8bf7\u6c42\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u53c2\u89c1\u201c\u8bfb\u53d6\u4f1a\u8bae\u4fe1\u606f\u201d\u90e8\u5206\u3002"]}),"\n",(0,r.jsx)(n.h6,{id:"http-4xx",children:"HTTP 4xx"}),"\n",(0,r.jsxs)(n.p,{children:["\u5176\u4ed6\u54cd\u5e94\u4ee3\u7801\u5c06\u5bfc\u81f4\u4f1a\u8bae\u521b\u5efa\u5931\u8d25\u3002JSON\u54cd\u5e94\u53ef\u4ee5\u5305\u542b\u4e00\u4e2a ",(0,r.jsx)(n.code,{children:"message"})," \u5bf9\u8c61\uff0c\u8be5\u5bf9\u8c61\u5c06\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c",(0,r.jsx)(n.code,{children:"user1"})," \u5c1d\u8bd5\u901a\u8fc7\u5411Jicofo\u53d1\u9001 ",(0,r.jsx)(n.code,{children:"conference"})," IQ \u6765\u542f\u52a8\u65b0\u7684\u4f1a\u8bae\u3002\u7cfb\u7edf\u5c06\u62d2\u7edd\u8be5\u8bf7\u6c42\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u5ba2\u6237\u7aef -> Jicofo\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<iq from='client1@xmpp.com' to='jicofo.meet.com' type='set'>\n  <conference xmlns='http://jitsi.org/protocol/focus' room='testroom1' />\n</iq>\n"})}),"\n",(0,r.jsx)(n.p,{children:"Prosody -> \u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"POST /conference HTTP/1.1\ncontent-type:application/x-www-form-urlencoded;charset=utf-8\nhost: http://reservation.example.com\ncontent-length: length\n\nname=testroom1&start_time=2048-04-20T17%3A55%3A12.000Z&mail_owner=client1%40xmpp.com\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u4f1a\u8bae\u9884\u8ba2\u7cfb\u7edf -> Prosody\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'HTTP/1.1 403 Forbidden\nContent-Type: application/json; charset=utf-8\nContent-Length: length\n\n{\n  "message": "client1 is not allowed to create the room at this time"\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Prosody -> \u5ba2\u6237\u7aef\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"<iq from='jicofo.meet.com' to='client1@xmpp.com' type='error'>\n  <error type='cancel'>\n    <service-unavailable xmlns='urn:ietf:params:xml:ns:xmpp-stanzas' />\n    <text xmlns='urn:ietf:params:xml:ns:xmpp-stanzas'>\n          client1 is not allowed to create the room at this time\n    </text>\n    <reservation-error xmlns='http://jitsi.org/protocol/focus' error-code='403'/>\n  </error>\n</iq>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u8be5\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"text"})," \u548c ",(0,r.jsx)(n.code,{children:"reservation-error"})," \u5143\u7d20\u5411\u7528\u6237\u63d0\u4f9b\u6709\u610f\u4e49\u7684\u4fe1\u606f\u3002"]}),"\n",(0,r.jsx)(n.h5,{id:"\u8bfb\u53d6\u4f1a\u8bae\u4fe1\u606f",children:"\u8bfb\u53d6\u4f1a\u8bae\u4fe1\u606f"}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c ",(0,r.jsx)(n.code,{children:"HTTP POST"})," \u8bf7\u6c42\u7684\u54cd\u5e94\u4e3a ",(0,r.jsx)(n.code,{children:"409"}),"\uff0cProsody\u5c06\u5c1d\u8bd5\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"HTTP GET"})," \u8bf7\u6c42 ",(0,r.jsx)(n.code,{children:"/conference/{conflict_id}"})," \u7aef\u70b9\u8bfb\u53d6\u51b2\u7a81\u4f1a\u8bae\u7684\u4fe1\u606f\u3002\u54cd\u5e94\u5e94\u63d0\u4f9b\u5b58\u50a8\u5728\u9884\u8ba2\u7cfb\u7edf\u4e2d\u7684\u4f1a\u8bae\u7684\u6240\u6709\u4fe1\u606f\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"id"'}),"\uff1a\u9884\u8ba2\u7cfb\u7edf\u5206\u914d\u7684\u4f1a\u8bae\u6807\u8bc6\u7b26"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"name"'}),"\uff1a\u4f1a\u8bae\u5ba4\u540d\u79f0"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"mail_owner"'}),"\uff1a\u521b\u5efa\u4f1a\u8bae\u7684\u7528\u6237\u8eab\u4efd"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"start_time"'}),"\uff1a\u4f1a\u8bae\u5f00\u59cb\u7684\u65e5\u671f\u548c\u65f6\u95f4"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:'"duration"'}),"\uff1a\u8ba1\u5212\u7684\u4f1a\u8bae\u6301\u7eed\u65f6\u95f4\uff08\u4ee5\u79d2\u4e3a\u5355\u4f4d\uff09"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u9002\u7528\uff0c\u8fd8\u5e94\u63d0\u4f9b\u53ef\u9009\u7684 ",(0,r.jsx)(n.code,{children:"max_occupants"})," \u503c\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u793a\u4f8b\u54cd\u5e94JSON\u4e3b\u4f53\uff08\u5305\u542b\u4e0e\u5bf9 ",(0,r.jsx)(n.code,{children:"HTTP POST"})," \u7684 ",(0,r.jsx)(n.code,{children:"200 OK"})," \u76f8\u540c\u7684\u4fe1\u606f\uff09\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n  "id": 364758328,\n  "name": "conference1234",\n  "mail_owner": "user@server.com",\n  "start_time": "2048-04-20T17:55:12.000Z",\n  "duration": 900000\n}\n'})}),"\n",(0,r.jsx)(n.h5,{id:"\u5220\u9664\u4f1a\u8bae",children:"\u5220\u9664\u4f1a\u8bae"}),"\n",(0,r.jsxs)(n.p,{children:["Prosody\u5728\u4e24\u79cd\u60c5\u51b5\u4e0b\u5220\u9664\u9884\u8ba2\u7cfb\u7edf\u4e2d\u7684\u4f1a\u8bae\u3002\u9996\u5148\u662f\u5728\u6240\u6709\u7528\u6237\u79bb\u5f00XMPP\u591a\u7528\u6237\u804a\u5929\u623f\u95f4\u65f6\u3002\u5176\u6b21\u662f\u5728\u4f1a\u8bae\u6301\u7eed\u65f6\u95f4\u9650\u5236\u8d85\u51fa\u65f6\u3002\u5728\u540e\u4e00\u79cd\u60c5\u51b5\u4e0b\uff0cProsody\u5c06\u9500\u6bc1XMPP MUC\u623f\u95f4\u3002MUC\u623f\u95f4\u9500\u6bc1\u540e\uff0cProsody\u5c06\u5411 ",(0,r.jsx)(n.code,{children:"'/conference/{id}'"})," \u7aef\u70b9\u53d1\u9001 ",(0,r.jsx)(n.code,{children:"HTTP DELETE"})," \u8bf7\u6c42\uff0c\u5176\u4e2d ",(0,r.jsx)(n.code,{children:"{id}"})," \u66ff\u6362\u4e3a\u9884\u8ba2\u7cfb\u7edf\u5206\u914d\u7684\u4f1a\u8bae\u6807\u8bc6\u7b26\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"DELETE /conference/364758328 HTTP/1.1\nhost: http://reservation.example.com\n...\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5b9e\u65bd\u56fe",children:"\u5b9e\u65bd\u56fe"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(9692).A+"",width:"3506",height:"2480"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},9692:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/reservation-api-3e18d6acf620327d83e4e6deb021c1a9.png"},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var r=s(6540);const o={},i=r.createContext(o);function t(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);